/*
* @Author: wangjianfei
* @Date:   2017-05-19 10:31:46
* @Last Modified by:   wangjianfei
* @Last Modified time: 2017-05-25 14:36:04
*/

'use strict';
var isNotAjax=true;
if(isNotAjax){
	var data={
	  "ret_code": 0,
	  "ret_msg": "ok",
	  "list": [
	    {
	      "level_name": "萬人迷",
	      "user_list": [
		        {
		          "pfid": "1001085",
		          "headimg": "http://blob.ufile.ucloud.com.cn/c93f71544c5f7aabc4f435e38953189874bdefee4283f0e78dc912574733ccb2",
		          "nickname": "on",
		          "charm_val": 4397840,
		          "live_id": '12313213',
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1001086",
		          "headimg": "http://playback-langlive.cn-bj.ufileos.com/7c3bbc8a108513572de3596faa24e125.jpg",
		          "nickname": "GIF",
		          "charm_val": 3850548,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000048",
		          "headimg": "http://blob.ufile.ucloud.com.cn/c8d240b8dfb870238431f43a392b312fba00a22c15230aa66f8e33cacc6debda",
		          "nickname": "珍珠奶茶😱芋頭紅豆薏米",
		          "charm_val": 2793908,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000039",
		          "headimg": "http://blob.ufile.ucloud.com.cn/25f0e2243ac9f515ed3be2fb1854c8b7db8e04b195a088962179cf5937ae25dd",
		          "nickname": "哇呀唔唔無武呃呃😂哇咔",
		          "charm_val": 1445433,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        }
		      ]
	    },
	    {
	      "level_name": "大眾情人",
	      "user_list": [
		        {
		          "pfid": "1000110",
		          "headimg": "http://blob.ufile.ucloud.com.cn/6edcee496f8b38234f38c50ee1ea49f8bb332df142586f88d7943b6aa5419440",
		          "nickname": "下雨天记得要带☔️或雨衣",
		          "charm_val": 1196438,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023177",
		          "headimg": "http://blob.ufile.ucloud.com.cn/ac7b67bdececf6719bece36b0458c37c.jpg",
		          "nickname": "139@1-8👀",
		          "charm_val": 1069518,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023841",
		          "headimg": "http://blob.ufile.ucloud.com.cn/9997f3e49dbf7d65cc495f1a8e21d33cfcac35ede39d4830580a66085ea45832",
		          "nickname": "优雅的猫",
		          "charm_val": 1025738,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        }
	      ]
	    },
	    {
	      "level_name": "知心愛人",
	      "user_list": [
		        {
		          "pfid": "1000064",
		          "headimg": "http://blob.ufile.ucloud.com.cn/ac7b67bdececf6719bece36b0458c37c.jpg",
		          "nickname": "成都替补风风光光v🐳",
		          "charm_val": 708060,
		          "live_id": "456465",
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1024144",
		          "headimg": "http://blob.ufile.ucloud.com.cn/288888b8021a3e5182af8d6202c493dc212a43432f0286ca317274c06df3c1c7",
		          "nickname": "刚刚",
		          "charm_val": 648824,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000791",
		          "headimg": "http://blob.ufile.ucloud.com.cn/275dfd157b539b1d8979cb73e24bb9fa.jpg",
		          "nickname": "?哭哭好嘛",
		          "charm_val": 615122,
		          "live_id": "6465465",
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000079",
		          "headimg": "http://blob.ufile.ucloud.com.cn/9d94d6dd038d578c73a3fb644dff13bfd06fa76b14240939f847eb662dbcb25f",
		          "nickname": "娃哈哈😀😀",
		          "charm_val": 518832,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        }
	      ]
	    },
	    {
	      "level_name": "傾心戀人",
	      "user_list": [
		        {
		          "pfid": "1000044",
		          "headimg": "http://blob.ufile.ucloud.com.cn/92cee6a8ce12f7b01a58fd7fa990a1bb.jpg",
		          "nickname": "嘻嘻哈哈😄💔1213",
		          "charm_val": 427074,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000175",
		          "headimg": "http://blob.ufile.ucloud.com.cn/42c240a9348316341c2857348c7513f2.jpg",
		          "nickname": "❄️⛈🌩🌨☁️🌤",
		          "charm_val": 357450,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023977",
		          "headimg": "http://blob.ufile.ucloud.com.cn/6f2ab2a7fe6df12fa78902d699ab821a58add4a6b382fb9997d2dab55d34de7c",
		          "nickname": "猜猜你猜",
		          "charm_val": 317096,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1024320",
		          "headimg": "http://blob.ufile.ucloud.com.cn/711271adb1eacb24bd8e1df757f0481e.jpg",
		          "nickname": "小沙沙",
		          "charm_val": 300526,
		          "live_id": "10243201495103573",
		          "live_key": "phHO13",
		          "live_url": "rtmp://video.langlive.com/live/10243201495103573",
		          "stream_direction": 0,
		          "live_pfid": "1024320"
		        },
		        {
		          "pfid": "1000054",
		          "headimg": "http://blob.ufile.ucloud.com.cn/a8400b08327ffe107fb33596ddb0c02c.jpg",
		          "nickname": "(*๓´╰╯`๓)♡88",
		          "charm_val": 278999,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1024315",
		          "headimg": "http://blob.ufile.ucloud.com.cn/ac7b67bdececf6719bece36b0458c37c.jpg",
		          "nickname": "139@2-8🐯",
		          "charm_val": 269696,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1024117",
		          "headimg": "http://playback-langlive.ufile.ucloud.cn/41395b6c4851bbc8d2ac49b643ea1420",
		          "nickname": "",
		          "charm_val": 269696,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1024115",
		          "headimg": "http://blob.ufile.ucloud.com.cn/900547bacfbcd1256d541b5c64b22807d4de018b90f02a81d424e7e4bbf5fb3c",
		          "nickname": "iwowd",
		          "charm_val": 269696,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1024114",
		          "headimg": "http://blob.ufile.ucloud.com.cn/a747adead17838f95094a9aa8c113d47.jpg",
		          "nickname": "09",
		          "charm_val": 269696,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1024112",
		          "headimg": "http://blob.ufile.ucloud.com.cn/21f7bf5e3726604123b4e16c8d6a0a7d33837c8b0aef96f660696cf8fb8e2f14",
		          "nickname": "机会",
		          "charm_val": 269696,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1024110",
		          "headimg": "http://playback-langlive.ufile.ucloud.cn/41395b6c4851bbc8d2ac49b643ea1420",
		          "nickname": "",
		          "charm_val": 269696,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1024100",
		          "headimg": "http://playback-langlive.ufile.ucloud.cn/41395b6c4851bbc8d2ac49b643ea1420",
		          "nickname": "",
		          "charm_val": 269696,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000041",
		          "headimg": "http://playback-langlive.ufile.ucloud.cn/ce533fc1f9c0102ff649642dc989563f.jpg",
		          "nickname": "哈哈哈哈哈哈哈哈哈哈哈哈",
		          "charm_val": 258612,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        }
	      ]
	    },
	    {
	      "level_name": "蒹葭伊人",
	      "user_list": [
		        {
		          "pfid": "1000121",
		          "headimg": "http://blob.ufile.ucloud.com.cn/17a2e5de23b959724193313c4b7d0fc2.jpg",
		          "nickname": "Hi💕o(*￣▽￣*)",
		          "charm_val": 120576,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1000122",
		          "headimg": "http://blob.ufile.ucloud.com.cn/480d8577e7e473a30a2de29a28829dd72c8254ea10bffbab4436990a465eadfd",
		          "nickname": "嘻嘻",
		          "charm_val": 95288,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        },
		        {
		          "pfid": "1023987",
		          "headimg": "http://blob.ufile.ucloud.com.cn/2fb5d9538079fde4d4837c775632da5c636c90a3acd94f77af4f04c6d5cb51e5",
		          "nickname": "兔子不吃窝边草",
		          "charm_val": 61958,
		          "live_id": null,
		          "live_key": null,
		          "live_url": null,
		          "stream_direction": 0,
		          "live_pfid": 0
		        }
	      ]
	    }
	  ]
	}
}
// 1、请求数据
function getDate(){
	// $.post(domain+'v2/activity/dracula_data', {"HTTP_USER_TOKEN":token, "HTTP_USER_UID":pfid, "anchor_pfid":anchor_id },
	 	// function(data) {
            /*optional stuff to do after success */
            if(data.ret_code=="0"){
                //
                var users=data.list;
                chunkData(users,10)
            }
	    // },
		// "json"
    // );
}
getDate();

// 2、重新处理数据如果对应的list.length>10,就把对应的list每10个放在二维数组内，
// 不足10个放在二维数组的尾部，
function chunkData(lists,count){
	for(var i=0,leng=lists.length;i<leng;i++){
		var nowList=lists[i];
		// 获得每组对应的数据
		var now_list=lists[i].user_list;
		// 每组数据的length,分页用的到
		var innerLength=now_list.length;
		//2.3 如果有
		if(innerLength!=0&&innerLength>count){
             // 定义在每个对象上的二维数组外层
            nowList.outer=[];
            var sliceNum = 0, resIndex = 0;
			while (sliceNum < innerLength) {
			    nowList.outer[resIndex++] = now_list.slice(sliceNum, sliceNum += count);
			}
			// 大于10个先只拿二维数组的前10个
			nowList.finals=nowList.outer[0];
			// 多于10个 显示换一批按钮
			// $(".changeList").eq(i).addClass('change');
			// .attr('data-arr',nowList.outer)
		}else if(innerLength!=0&&innerLength<=count){
			nowList.finals=now_list;
		}
		
	}
	console.log(lists);
	printDom(lists);
}
// 3、渲染用户列表
function printDom(newLists){
	var listsLength=newLists.length;
	for(var k=0;k<listsLength;k++){
		var nowList=newLists[k];
		// 如果多于10个的二维数组,用以点击换一批
		var outerLists=JSON.stringify(newLists[k].outer);
		// 最終需要的
		var nowFinals=nowList.finals;
		// 返回的HTML
		var user_html=createHtml(nowFinals);
		// 渲染DOM
		$(".user-box"+k).append(user_html);
		// console.log(outerLists);
		if(typeof(outerLists)!="undefined"){
			$(".changeList").eq(k).addClass('change').attr('data-arr',outerLists).attr('data-index',k).attr('data-init',0);
		}
	}
	// 绑定事件
	addEvent();
}
// return html
function createHtml(nowFinals){
	var finalsLength=nowFinals.length;
	var user_html="";
	if(finalsLength!=0){
		for(var j=0;j<finalsLength;j++){
			var temp_lists=nowFinals[j];
			var temp_charm=temp_lists.charm_val;
			var temp_headimg=temp_lists.headimg;
			var temp_liveId=temp_lists.live_id;
			var temp_liveKey=temp_lists.live_key;
			var temp_livePfid=temp_lists.pfid;
			var temp_liveUrl=temp_lists.live_url;
			var temp_name=temp_lists.nickname;
			var temp_direction=temp_lists.stream_direction;
			// 拼接DOM
			user_html+='<li>';
			user_html+='<div data-direction="'+temp_direction+'" data-livekey="'+temp_liveKey+'" data-liveurl="'+temp_liveUrl+'" data-nickname="'+temp_name+'" data-pfid="'+temp_livePfid+'" data-liveid="'+temp_liveId+'" class="user-img">';
			user_html+='<img src="'+temp_headimg+'" alt="">';
			if(temp_liveId!=null){
				user_html+="<i></i>";
			}
			user_html+='</div>';
			user_html+='<div class="user-info">';
			user_html+='<p>'+temp_name+'</p>';
			user_html+='<p>魅力值 '+temp_charm+'</p>';;
			user_html+='</div>';
			user_html+='</li>';
		}
	}
	return user_html;
}
// 换一批事件,可以通过自定义属性，或者自定义一个数组同样可以解决
function addEvent(){
	// var tempIndex=0;
	// var btns=[0,0,0,0,0];
	$(document).on('click', '.changeList', function(event) {
		event.preventDefault();
		event.stopPropagation();
		var arr=JSON.parse($(this).attr('data-arr'));
		var index=$(this).attr('data-index');
		var tempIndex=$(this).attr('data-init');
		var arrLength=arr.length;
		tempIndex++;
		if(tempIndex==arrLength) tempIndex=0;
		$(this).attr('data-init',tempIndex);
		var temp_html=createHtml(arr[tempIndex]);
		$(".user-box"+index).empty().append(temp_html);
		console.log(tempIndex);
	});
}


// 返回頂部
$("#backTop").click(function(){
	$(document).scrollTop(0);
});
$(document).scroll(function(){
	if ($(document).scrollTop() > 300) {
			$('#backTop').show();
	} else {
			$('#backTop').hide();
	}
})