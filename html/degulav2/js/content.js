/*
* @Author: wangjianfei
* @Date:   2017-04-28 15:32:29
* @Last Modified by:   wangjianfei
* @Last Modified time: 2017-05-03 18:07:24
*/

'use strict';
var isNotAjax=true;
if(isNotAjax){
	var data={
	  "ret_code": "0",
	  "ret_msg": "ok",
	  "data": {
	    "users": [
		      {
	        "pfid": 1000011,
	        "nickname": "cabbageancy",
	        "headimg": "http://wx.qlogo.cn/mmopen/ajNVdqHZLLASXYCVQQeiaXKA07Mx1Lu24juBVZ40ib9IsI6ImibfsWD1R3JS5I5L4LZMmgxpC4B7Y1taCZmXHQVKic4lbHibcntI7L6S7K4gnMW8/0",
	        "count": 0,
	        "follow_status": 0,
	        "score": 19,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1000004,
	        "nickname": "减肥沟沟壑壑健健康康快快",
	        "headimg": "http://playback-langlive.ufile.ucloud.cn/4825891161c4d9a377be0785078c2158.jpg",
	        "count": 0,
	        "follow_status": 0,
	        "score": 17,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1023841,
	        "nickname": "优雅的猫",
	        "headimg": "http://blob.ufile.ucloud.com.cn/e101f4896dbd4de38b7d7e7123828ee608d7b97251148720bb7678bf10ea21b8",
	        "count": 0,
	        "follow_status": null,
	        "score": 15,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1000044,
	        "nickname": "嘻嘻哈哈😄💔1213",
	        "headimg": "http://blob.ufile.ucloud.com.cn/45bd20f480c941f800a101bb484cb8be.jpg",
	        "count": 0,
	        "follow_status": null,
	        "score": 13,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1000048,
	        "nickname": "珍珠奶茶😱芋頭紅豆薏米",
	        "headimg": "http://blob.ufile.ucloud.com.cn/c8d240b8dfb870238431f43a392b312fba00a22c15230aa66f8e33cacc6debda",
	        "count": 0,
	        "follow_status": null,
	        "score": 10,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1000830,
	        "nickname": "58665",
	        "headimg": "http://blob.ufile.ucloud.com.cn/a765a85a32fde0343476d3d5a54ce686d9370cd4e35f4ac941661c2ab6746bcd",
	        "count": 0,
	        "follow_status": null,
	        "score": 9,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1000941,
	        "nickname": "随意",
	        "headimg": "http://playback-langlive.ufile.ucloud.cn/41395b6c4851bbc8d2ac49b643ea1420",
	        "count": 0,
	        "follow_status": 0,
	        "score": 8,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1000052,
	        "nickname": "upper",
	        "headimg": "http://blob.ufile.ucloud.com.cn/9256deb2c705849daef63ace024d4fe121e68f712eefdc585692247a52cf1920",
	        "count": 0,
	        "follow_status": null,
	        "score": 7,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1000733,
	        "nickname": "查房",
	        "headimg": "http://playback-langlive.ufile.ucloud.cn/8422f67af167df7d2b2caa78ac0a4773c4eade4575b343b5a82b7a48c4bf1427",
	        "count": 0,
	        "follow_status": null,
	        "score": 6,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1000012,
	        "nickname": "c224002",
	        "headimg": "http://blob.ufile.ucloud.com.cn/0d94ae9dc33721c87af78a7b2099f5a7ab7395972444c7ab979e3dea46e8ba2e",
	        "count": 0,
	        "follow_status": null,
	        "score": 5,
	        "live_id":"454654646"
	      },
	      {
	        "pfid": 1000039,
	        "nickname": "哇呀唔唔無武呃呃😂哇咔",
	        "headimg": "http://blob.ufile.ucloud.com.cn/25f0e2243ac9f515ed3be2fb1854c8b7db8e04b195a088962179cf5937ae25dd",
	        "count": 0,
	        "follow_status": null,
	        "score": 4,
	        "live_id":null
	      },
	      {
	        "pfid": 1000049,
	        "nickname": "思考解决",
	        "headimg": "http://blob.ufile.ucloud.com.cn/6b7f50b02ed10b72159ccf1f00a73ab9.jpg",
	        "count": 0,
	        "follow_status": null,
	        "score": 3,
	        "live_id":null
	      },
	      {
	        "pfid": 1000040,
	        "nickname": "🐾\"sting\"💤",
	        "headimg": "http://blob.ufile.ucloud.com.cn/3f8f9f008d9d34a9b4cdffd32a06a3d8.jpg",
	        "count": 0,
	        "follow_status": null,
	        "score": 2,
	        "live_id":null
	      },
	      {
	        "pfid": 1000010,
	        "nickname": "gggggg",
	        "headimg": "http://blob.ufile.ucloud.com.cn/f9cb7d8ac961fb9b3d5a882aea55bfe5",
	        "count": 0,
	        "follow_status": null,
	        "score": 1,
	        "live_id":null
	      }
	    ],
	    "my": {
	      "live_id": null,
	      "live_key": "",
	      "stream_direction": 0,
	      "live_url": "",
	      "headimg": "http://blob.ufile.ucloud.com.cn/c8d240b8dfb870238431f43a392b312fba00a22c15230aa66f8e33cacc6debda",
	      "nickname": "珍珠奶茶😱芋頭紅豆薏米",
	      "pfid": 1000048,
	      "follow_status": 0
	    }
	  }
	}
}

var isLiving="";
//2.0 请求数据
function getDate(){
// 	$.post(domain+'v2/activity/dracula_data', {"HTTP_USER_TOKEN":token, "HTTP_USER_UID":pfid, "anchor_pfid":anchor_id },
// 	 	function(data) {
		/*optional stuff to do after success */
		// if(data.ret_code=="0"){
			//第一集的数据为
			var users=data.data.users;
			//第二集为
			// var secendData=data.data[1];
			isLiving=data.data.my;
			// resetData(users);
			// 0503
			sortData(users);
			// 是否在直播
			isLive(isLiving);
		// }
	// });
}
getDate();
// resetData
var arrdata;
function resetData(users){
	arrdata=[
		{
			lists:users[0]
		},
		{
			lists:users[1]
		}
	];
	for(var m=0;m<arrdata.length;m++){
		var lists=arrdata[m].lists;
		sortData(lists);
		prentData(m,lists);
		// console.log(lists);
		
	}
}
// 1 把人員按照積分从高到底排列
function sortData(lists){
	for(var n=1;n<lists.length;n++){
		for(var k=0;k<lists.length-1;k++){
			var max=lists[k].score;
			var nextCount=lists[k+1].score;
			if(nextCount>max){
				var preData=lists[k];
				lists[k]=lists[k+1];
				lists[k+1]=preData;
			}
		}
	}
	// 0503
	prentData(lists);
}
// 2
function prentData(userData){
	var user_html="";
	// $(".userlist"+num).empty();
	for(var i=0,leng=userData.length;i<leng;i++){
		var userList=userData[i];
		var followStatus=userList.follow_status;
		var userName=userList.nickname;
		var index=i+1;
		var num='0'+index;
		if(index>9){
			num=index;
		}
		//0503 進入直播間還是主頁的參數
		var this_liveid=userList.live_id;
		var this_pfid=userList.pfid;
		var this_nickname=userList.nickname;
		var this_liveurl=userList.live_url;
		var this_livekey=userList.live_key;
		var this_direction=userList.direction;
		var this_headimg=userList.headimg;
		user_html+="<li>";
		user_html+="<b>"+num+".</b>";
		user_html+="<div data-direction='"+this_direction+"' data-livekey='"+this_livekey+"' data-liveurl='"+this_liveurl+"' data-nickname='"+this_nickname+"' data-pfid='"+this_pfid+"' data-liveid='"+this_liveid+"' class='main-img'>";
		// 是否正在直播
		user_html+="<img src='"+userList.headimg+"' alt=''>";
		// 是否正在直播
		if(this_liveid!=null){
			user_html+="<span></span>";
		}
		user_html+="</div>";
		user_html+="<span>"+userName+"</span>";
		user_html+="<b class='score'>"+userList.score+"</b>";
		user_html+="<b class='ticket'>"+userList.count+"</b>";
		// 是否可以追蹤
		if(followStatus==0){
			user_html+="<button class=willFollow data-pfid='"+userList.pfid+"'>追蹤</button>";
		}
		user_html+="</li>";
	}
	$("#users-one").append(user_html);
	console.log(userData);
}

// 中間導航的切換
var $navbtn=$(".nav-btn");
$navbtn.click(function(){
	var index=$(this).attr('data-index');
	$(this).addClass('on').siblings().removeClass('on');
	$(".user-list").eq(index).show().siblings('.user-list').hide();
	// 重新請求一次數據
	getDate();
	console.log(index);
});

// 頂部是否是在直播狀態
function isLive(live){
	// console.log(live);
	var liveId=live.live_id;
	var liveKey=live.live_key;
	var liveUrl=live.live_url;
	var direction=live.stream_direction;
	var headimg=live.headimg;
	var liveNickname=live.nickname;
	var livePfid=live.pfid;
	var nowstatus=live.follow_status;
	if(liveId!=null){
		$("#isLiving").css({
			display:"block"
		});
		$("#isLiving").click(function(){
			h5toRoom(livePfid,liveNickname,liveId,liveUrl,liveKey,direction);
		});
	}else if(liveId==null){
		$("#isLiving").css({
			display:"none"
		});
		if(nowstatus==1){
			$("#isFlow").css({
				display:"none"
			});
		}else if(nowstatus==0){
			$("#isFlow").css({
				display:"block"
			});
			$("#isFlow").click(function(){
				$(this).addClass('followed');
				follow(livePfid);
			});
		}
	}
}

// 點擊追蹤按鈕
$(".user-list").on('click', '.willFollow', function(event) {
	var willPfid=$(this).attr('data-pfid');
	$(this).addClass('followed');
	console.log(willPfid);
	//公用方法
	follow(willPfid);
})
//客戶端返回追蹤狀態
function langApp2Web_httprtn(result,follow){
	if(isiOS == true){
		if(JSON.parse(result).ret_code == "0"){
			$(".followed").css({
				display:"none"
			}); 
		}else{
			alert(JSON.parse(result).ret_msg);
		}
	}else{
		if(JSON.parse(follow).ret_code == "0"){
			$(".followed").css({
				display:"none"
			}); 
		}else{
			alert(JSON.parse(follow).ret_msg);
		}
	}
		
}
// 点击头像判断是跳转到直播间还是主页
$("#users-one").on('click', '.main-img', function(event) {
	event.preventDefault();
	event.stopPropagation();
	/* Act on the event */
	// pfid,nickname,liveid,liveurl,livekey,direction
	var pfid=$(this).attr('data-pfid');
	var nickname=$(this).attr('data-nickname');
	var liveid=$(this).attr('data-liveid');
	var liveurl=$(this).attr('data-liveurl');
	var livekey=$(this).attr('data-livekey');
	var direction=$(this).attr('data-direction');
	if(liveid!="null"){
		// 进入直播间
		alert("进入直播间");
		// h5toRoom(pfid,nickname,liveid,liveurl,livekey,direction);
	// 如果没在直播，进入个人主页	
	}else{
		alert("进入个人主页");
		// h5toHomepage(pfid,nickname);
	}
});
$(document).scroll(function(){
	if ($(document).scrollTop() > 300) {
			$('.backTop').show();
	} else {
			$('.backTop').hide();
	}
})

$(".backTop").click(function(){
	$(document).scrollTop(0);
});